(()=>{"use strict";var e,t,s;!function(e){e.goods="goods",e.sp="sp",e.tff="tff",e.contacts="contacts"}(e||(e={})),function(e){e.posts="posts",e.followers="followers",e.subscriptions="subscriptions",e.likes="likes"}(t||(t={})),function(e){e.subscriptionsSp="subscriptions-sp",e.subscriptionsTff="subscriptions-tff",e.subscriptionsBloggers="subscriptions-bloggers",e.subscriptionsShops="subscriptions-shops",e.likesGoods="likes-goods",e.likesPublications="likes-publications"}(s||(s={})),Object.values(t),Object.values(s);const i={autocomplete:"https://62dd423d79b9f8c30aa554e1.mockapi.io/autocomplete"};var o;!function(e){e.choose="choose-goods",e.filling="filling",e.preview="preview",e.created="image-created"}(o||(o={}));class l{constructor(){this.selector=".popup",this.popupCloseSelector=".popup__close",this.dataAttributePopup="[data-popup]",this.dataAttributeClosePopup="[data-close-popup]",this.popupOpenClass="popup--open",this.overflowClass="overflow",this.popupOverlayClass="popup__overlay",this.init()}init(){this.handlers(),[768,1200].forEach((e=>{window.matchMedia(`(min-width:${e}px)`).addListener((e=>this.breakpointChecker(e)))}))}breakpointChecker(e){const t=e.media.replace(/\D/g,"");Array.from(document.querySelectorAll(`${this.selector}--open`)).forEach((e=>{const s=e.dataset.media;s&&Number(t)>=Number(s)&&this.closePopup(e)}))}openPopup(e){const t=document.getElementById(e.dataset.popup||"");if(!t)throw new Error(`no attribute value: ${this.dataAttributePopup}`);{let e=!0;const s=Number(t.dataset.media);s&&s<window.innerWidth&&(e=!1),e&&(t.classList.add(this.popupOpenClass),document.body.classList.add(this.overflowClass),document.dispatchEvent(new CustomEvent("openPopup",{detail:null==t?void 0:t.id})))}}checkOpenedPopups(){return[...document.querySelectorAll(this.selector)].some((e=>e.classList.contains("popup--open")))}closePopup(e){var t;const s=e.closest(this.selector)||document.getElementById((null===(t=null==e?void 0:e.dataset)||void 0===t?void 0:t.closePopup)||"");null==s||s.classList.remove(this.popupOpenClass),this.checkOpenedPopups()||document.body.classList.remove(this.overflowClass),document.dispatchEvent(new CustomEvent("closePopup",{detail:null==s?void 0:s.id}))}clickHandler(e){const t=e.target;return t.closest(this.dataAttributeClosePopup)&&t.closest(this.dataAttributePopup)?(this.closePopup(t),this.openPopup(t.closest(this.dataAttributePopup))):t.classList.contains(this.popupOverlayClass)||t.closest(this.popupCloseSelector)||t.closest(this.dataAttributeClosePopup)?this.closePopup(t):void(t.closest(this.dataAttributePopup)&&this.openPopup(t.closest(this.dataAttributePopup)))}handlers(){document.addEventListener("click",(e=>this.clickHandler(e)))}}class r{constructor(){this.selectorActionBtn=".header__nav-more",this.selectorUsefulLinks=".useful-links",this.selectorUsefulLinksCross=".useful-links__title-cross";const e=document.querySelector(this.selectorUsefulLinks);e&&(this.usefulLinksElem=e),this.usefulLinksElem&&this.init()}init(){window.matchMedia("(min-width:1200px)").addListener((e=>this.breakpointChecker(e))),this.handlers()}breakpointChecker(e){this.usefulLinksElem.classList.contains("active")&&(e.matches?document.body.classList.remove("overflow"):document.body.classList.add("overflow"))}toggle(){this.usefulLinksElem.classList.toggle("active"),document.body.classList.toggle("overflow")}clickHandler(e){const t=e.target;(t.closest(this.selectorActionBtn)||t.closest(this.selectorUsefulLinksCross))&&this.toggle()}handlers(){document.addEventListener("click",(e=>this.clickHandler(e)))}}const n=(e,t)=>{return s=void 0,i=void 0,l=function*(){var s;const i=Object.assign(Object.assign({},{method:"get"}),t);try{const o=yield fetch(e,Object.assign(Object.assign({credentials:i.credentials,headers:"get"===i.method?{}:{"Content-Type":"application/json"}},i),{signal:null===(s=t.fetchController)||void 0===s?void 0:s.signal})),{status:l}=o,r=yield o.json();return r.detail?{error:r.detail,status:l}:{data:r,status:l}}catch(e){return{error:e}}},new((o=void 0)||(o=Promise))((function(e,t){function r(e){try{c(l.next(e))}catch(e){t(e)}}function n(e){try{c(l.throw(e))}catch(e){t(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof o?s:new o((function(e){e(s)}))).then(r,n)}c((l=l.apply(s,i||[])).next())}));var s,i,o,l},c=(e,t)=>{let s;return function(){clearTimeout(s),s=setTimeout((()=>{e.apply(this,arguments)}),t)}};class a{constructor(){}validateForm(e,t,s,i){var o,l,r,n,c,a,d;if(i){const h=t[i],u=e[i];if(typeof u!==h.type)return{[i]:(null===(o=h.messages)||void 0===o?void 0:o.type)||"неверный тип"};if(!u&&h.required)return{[i]:(null===(l=h.messages)||void 0===l?void 0:l.required)||"поле должно быть не пустым"};if("object"===h.type&&h.required){const e=((null===(r=null==s?void 0:s.files)||void 0===r?void 0:r.length)||0)>0;if(console.log("hasFiles",e),!e)return{[i]:(null===(n=h.messages)||void 0===n?void 0:n.required)||"не добавлены файлы"}}if("string"==typeof u&&h.minLength&&u.length<h.minLength)return{[i]:(null===(c=h.messages)||void 0===c?void 0:c.minLength)||"слишком мало символов"};if("string"==typeof u&&h.maxLength&&u.length>h.maxLength)return{[i]:(null===(a=h.messages)||void 0===a?void 0:a.maxLength)||"слишком много символов"};if("string"==typeof u&&h.pattern&&!h.pattern.test(u))return{[i]:(null===(d=h.messages)||void 0===d?void 0:d.pattern)||""}}return null}}class d extends a{constructor({selectorForm:e,url:t,apiOptions:s,validateSchema:i,onValidation:o,onSubmit:l}){super(),this.getFormData=()=>{const e=new FormData(this.formElem);return Array.from(e.entries()).reduce(((e,[t,s])=>{var i;if(this.validateSchema&&"object"===(null===(i=this.validateSchema[t])||void 0===i?void 0:i.type)){const s=this.formElem.querySelector(`[name=${t}]`);return e[t]=s.files,e}return e[t]=s,e}),{})},this.selectorForm=e,this.url=t,this.apiOptions=s||{},this.validateSchema=i,this.onValidation=o,this.onSubmit=l,this.stateForm={values:{},errors:{},isValid:!1,isSubmitting:!1},this.validateSchema&&(this.requiredFields=Object.entries(this.validateSchema).reduce(((e,[t,s])=>(s.required&&e.push(t),e)),[]));const r=document.querySelector(this.selectorForm);r&&(this.formElem=r);const n=this.formElem.querySelector('.submit, button[type="submit"]');n&&(this.btnSubmitElem=n),this.formElem&&this.init()}init(){this.handlers(),this.setInitialValues()}setInitialValues(){const e=this.getFormData();this.stateForm.values=Object.assign({},e)}submitForm(){var e,t,s,i,o,l,r;return i=this,o=void 0,r=function*(){if(this.url&&this.apiOptions){const i=this.getFormData();this.validateForm(i,this.validateSchema||{});const{method:o}=this.apiOptions;let l=this.url;if("get"===o){const e=new URLSearchParams;Object.entries(i).forEach((([t,s])=>e.append(t,String(s)))),l=`${this.url}?${e.toString()}`}else this.apiOptions=Object.assign(Object.assign({},this.apiOptions),{body:JSON.stringify(i)});null===(e=this.btnSubmitElem)||void 0===e||e.classList.add("active");const r=yield n(l,this.apiOptions);null===(t=this.btnSubmitElem)||void 0===t||t.classList.remove("active"),this.btnSubmitElem&&(this.btnSubmitElem.disabled=!0),null===(s=this.onSubmit)||void 0===s||s.call(this,r,i)}},new((l=void 0)||(l=Promise))((function(e,t){function s(e){try{c(r.next(e))}catch(e){t(e)}}function n(e){try{c(r.throw(e))}catch(e){t(e)}}function c(t){var i;t.done?e(t.value):(i=t.value,i instanceof l?i:new l((function(e){e(i)}))).then(s,n)}c((r=r.apply(i,o||[])).next())}))}addError(e,t){const s=this.formElem.querySelector(`[data-id="parent-${e}"]`),i=this.formElem.querySelector(`[data-id="error-${e}"]`);s&&(s.classList.remove("success"),s.classList.add("error")),i&&t&&(i.classList.add("active"),i.textContent=t)}clearError(e){const t=this.formElem.querySelector(`[data-id="parent-${e}"]`),s=this.formElem.querySelector(`[data-id="error-${e}"]`);t&&(t.classList.remove("error"),t.classList.add("success")),s&&(s.classList.remove("active"),s.textContent="")}checkValid(){Object.keys(this.stateForm.errors).length>0?(this.stateForm.isValid=!1,this.btnSubmitElem&&(this.btnSubmitElem.disabled=!0)):(this.stateForm.isValid=!0,this.btnSubmitElem&&(this.btnSubmitElem.disabled=!1),Object.entries(this.stateForm.values).forEach((([e,t])=>{"object"==typeof t&&0===Object.values(t).length&&this.requiredFields.includes(e)&&(this.stateForm.isValid=!1,this.btnSubmitElem&&(this.btnSubmitElem.disabled=!0)),!t&&this.requiredFields.includes(e)&&(this.stateForm.isValid=!1,this.btnSubmitElem&&(this.btnSubmitElem.disabled=!0))})))}changeHandler(e){var t;const s=e.target,i=s.name,o=s.value;if("file"===s.type&&s.files){const e=Array.isArray(this.stateForm.values[i])?this.stateForm.values[i]:[],t=Array.from(s.files);this.stateForm.values[i]=[...e,...t]}else this.stateForm.values[i]=o;if(this.validateSchema){const e=Object.fromEntries(Object.entries(this.getFormData()).filter((([e])=>Object.prototype.hasOwnProperty.call(this.validateSchema,e)))),o=this.validateForm(e,this.validateSchema,s,i);if(o){const e=o[i];this.addError(i,e),this.stateForm.errors[i]=e}else{this.clearError(i);const e=this.stateForm.errors,t=i,s=(e[t],function(e,t){var s={};for(var i in e)Object.prototype.hasOwnProperty.call(e,i)&&t.indexOf(i)<0&&(s[i]=e[i]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(i=Object.getOwnPropertySymbols(e);o<i.length;o++)t.indexOf(i[o])<0&&Object.prototype.propertyIsEnumerable.call(e,i[o])&&(s[i[o]]=e[i[o]])}return s}(e,["symbol"==typeof t?t:t+""]));this.stateForm.errors=s}this.checkValid(),null===(t=this.onValidation)||void 0===t||t.call(this,this.stateForm)}}handlers(){this.formElem.addEventListener("change",(e=>this.changeHandler(e))),this.formElem.addEventListener("submit",(e=>{e.preventDefault(),this.submitForm()}))}}class h{constructor(){this.selectorContainer=".login",this.selectorBtnSignIn=".login__choice-sign-in",this.selectorBtnSignUp=".login__choice-sign-up";const e=document.querySelector(this.selectorContainer);e&&(this.containerElem=e);const t=document.querySelector(this.selectorBtnSignIn);t&&(this.btnSignInElem=t);const s=document.querySelector(this.selectorBtnSignUp);s&&(this.btnSignUpElem=s),this.btnSignInElem&&this.btnSignUpElem?this.init():console.error(`No items found: ${this.selectorBtnSignIn}, ${this.selectorBtnSignUp}`)}init(){this.handlers()}toggle(e){e.closest(this.selectorBtnSignIn)?(this.containerElem.classList.remove(`${this.selectorContainer.substring(1)}--sign-up`),this.containerElem.classList.add(`${this.selectorContainer.substring(1)}--sign-in`)):(this.containerElem.classList.remove(`${this.selectorContainer.substring(1)}--sign-in`),this.containerElem.classList.add(`${this.selectorContainer.substring(1)}--sign-up`))}clickHandler(e){const t=e.target;(t.closest(this.selectorBtnSignIn)||t.closest(this.selectorBtnSignUp))&&this.toggle(t)}handlers(){document.addEventListener("click",(e=>this.clickHandler(e)))}}class u{constructor(){this.selectedOption=e=>{console.log("selected option autocomplete",e),"pickup"===this.deliveryType&&(e.value?(this.searchPickupBtnElem.disabled=!1,this.mapPickupBtnElem.disabled=!1,this.pickupSelected=e,window.innerWidth<1200?this.pickupInputElem.value=e.label:this.searchInputElem.value=e.label):(this.searchPickupBtnElem.disabled=!0,this.mapPickupBtnElem.disabled=!0,this.pickupSelected={label:"",value:""},window.innerWidth<1200?this.pickupInputElem.value="":this.searchInputElem.value="")),"courier"===this.deliveryType&&(e.value?(this.mapCourierBtnElem.disabled=!1,this.courierSelected=e,this.courierFullAddressElem.innerHTML="",this.courierFullAddressElem.innerHTML=e.label):(this.mapCourierBtnElem.disabled=!0,this.courierSelected={label:"",value:""},this.courierFullAddressElem.innerHTML=""))},this.mapId="#maps",this.searchPickupId="#search-pickup",this.courierAddressId="#courier",this.templateAddressId="#address",this.isLoadMap=!1,this.deliveryType="pickup",this.headerSelector=".header",this.headerAddressSelector=`${this.headerSelector}__top-location-address`,this.mapSelector=".map",this.courierSelector=".courier",this.searchPickupSelector=".search-pickup",this.pickupInputSelector=".map__autocomplete--pickup input",this.courierInputSelector=".map__autocomplete--courier input",this.searchInputSelector=`${this.searchPickupSelector} input`,this.mapYandexSelector=".map__yandex",this.addressSelector=".location__address",this.addressCitySelector=".location__address-city-name",this.addressSelectedSelector=`${this.addressSelector}--selected`,this.addressRemoveSelector=`${this.addressSelector}-remove`,this.locationAddressesSelector=".location__addresses",this.radioDeliveryName="choose-delivery",this.courierFullAddress=`${this.courierSelector}__actions-inputs-full`,this.searchPickupBtnSelector=`${this.searchPickupSelector}__btn`,this.mapPickupBtnSelector=`${this.mapSelector}__btn--pickup`,this.mapCourierBtnSelector=`${this.mapSelector}__btn--courier`,this.addressElems=Array.from(document.querySelectorAll(this.addressSelector));const e=document.querySelector(this.mapId);e&&(this.iframeMapElem=e);const t=document.querySelector(this.templateAddressId);t&&(this.templateAddressElem=t);const s=document.querySelector(this.searchPickupId);s&&(this.searchPickupElem=s);const i=this.searchPickupElem.querySelector(this.searchInputSelector);i&&(this.searchInputElem=i);const o=this.searchPickupElem.querySelector(this.searchPickupBtnSelector);o&&(this.searchPickupBtnElem=o);const l=document.querySelector(this.courierAddressId);l&&(this.courierAddressElem=l);const r=document.querySelector(this.mapSelector);r&&(this.mapElem=r);const n=document.querySelector(this.mapYandexSelector);n&&(this.mapYandexElem=n);const c=this.mapElem.querySelector(this.mapPickupBtnSelector);c&&(this.mapPickupBtnElem=c);const a=this.mapElem.querySelector(this.mapCourierBtnSelector);a&&(this.mapCourierBtnElem=a);const d=document.querySelector(this.pickupInputSelector);d&&(this.pickupInputElem=d);const h=document.querySelector(this.courierInputSelector);h&&(this.courierInputElem=h);const u=document.querySelector(this.headerSelector);u&&(this.headerElem=u);const p=document.querySelector(this.addressCitySelector);p&&(this.addressCityElem=p);const m=document.querySelector(this.headerAddressSelector);m&&(this.headerAddressElem=m);const v=document.querySelector(this.locationAddressesSelector);v&&(this.locationAddressesElem=v);const S=document.querySelector(this.courierFullAddress);S&&(this.courierFullAddressElem=S),this.init()}init(){this.handlers(),this.mapElem.classList.add(`${this.mapSelector.substring(1)}--pickup`),window.matchMedia("(min-width:1200px)").addListener((e=>this.breakpointChecker(e))),navigator.geolocation.getCurrentPosition((function(e){console.log("geolocation",e.coords.latitude,e.coords.longitude)}),(function(e){console.log(e.message)}))}breakpointChecker(e){e.matches&&(this.searchPickupElem.classList.remove("popup--open"),this.courierAddressElem.classList.remove("popup--open"))}selectedAddress(e){var t,s,i;this.addressElems.forEach((t=>{t.classList.remove(this.addressSelectedSelector.substring(1)),t===e&&t.classList.add(this.addressSelectedSelector.substring(1))}));const o=e.dataset.delivery,l=null===(i=null===(s=null===(t=e.querySelector(".location__address-address"))||void 0===t?void 0:t.innerHTML)||void 0===s?void 0:s.split(","))||void 0===i?void 0:i.slice(1).join(",");this.headerAddressElem.innerHTML=`${"pickup"===o?"Пункт выдачи,":""} ${l}`}addAddress(e){let t=!0;if(this.pickupSelected&&(t=this.addressElems.some((e=>{var t;return e.dataset.value===(null===(t=this.pickupSelected)||void 0===t?void 0:t.value)}))),this.courierSelected&&(t=this.addressElems.some((e=>{var t;return e.dataset.value===(null===(t=this.courierSelected)||void 0===t?void 0:t.value)}))),!t){const t=this.templateAddressElem.content.cloneNode(!0),s=t.querySelector(".location__address"),i=t.querySelector(".location__address-option"),o=t.querySelector(".location__address-address");s&&i&&o&&("pickup"===e&&this.pickupSelected&&(o.textContent=this.pickupSelected.label,i.textContent="Пункт выдачи",s.dataset.value=this.pickupSelected.value),"courier"===e&&this.courierSelected&&(o.textContent=this.courierSelected.label,i.textContent="Доставка по адресу",s.dataset.value=this.courierSelected.value)),this.locationAddressesElem.prepend(t),this.addressElems=Array.from(document.querySelectorAll(this.addressSelector))}}removeAddress(e){return t=this,s=void 0,o=function*(){const t=e.dataset.value;console.log("remove address",t),e.remove(),this.addressElems=Array.from(document.querySelectorAll(this.addressSelector))},new((i=void 0)||(i=Promise))((function(e,l){function r(e){try{c(o.next(e))}catch(e){l(e)}}function n(e){try{c(o.throw(e))}catch(e){l(e)}}function c(t){var s;t.done?e(t.value):(s=t.value,s instanceof i?s:new i((function(e){e(s)}))).then(r,n)}c((o=o.apply(t,s||[])).next())}));var t,s,i,o}openPopup(e){e.classList.add("popup--open")}changeDelivery(e){"courier"===e?(this.mapElem.classList.remove(`${this.mapSelector.substring(1)}--pickup`),this.mapElem.classList.add(`${this.mapSelector.substring(1)}--courier`)):(this.mapElem.classList.remove(`${this.mapSelector.substring(1)}--courier`),this.mapElem.classList.add(`${this.mapSelector.substring(1)}--pickup`)),this.deliveryType=e}loadMap(){const e=this.iframeMapElem.dataset.src;this.iframeMapElem.addEventListener("load",(()=>{this.mapYandexElem.classList.add(`${this.mapYandexSelector.substring(1)}--load`)})),e&&(this.iframeMapElem.src=e,this.isLoadMap=!0)}selectedCity(e){this.addressCityElem.innerHTML=e}clickHandler(e){const t=e.target,s=t.closest(this.addressSelector),i=t.closest(this.addressRemoveSelector);!this.isLoadMap&&t.closest('[data-popup="map"]')&&this.loadMap(),i&&s&&this.removeAddress(s),s&&!i&&this.selectedAddress(s),this.mapPickupBtnElem.contains(t)&&this.addAddress("pickup"),this.mapCourierBtnElem.contains(t)&&window.innerWidth<1200&&this.openPopup(this.courierAddressElem)}focusHandler(e){e.target===this.pickupInputElem&&window.innerWidth<1200&&"pickup"===this.deliveryType&&(this.openPopup(this.searchPickupElem),this.pickupInputElem.blur())}changeHandler(e){const t=e.target,s=t.name,i=t.value;s===this.radioDeliveryName&&this.changeDelivery(i),"city"===s&&this.selectedCity(i)}handlers(){this.headerElem.addEventListener("click",(e=>this.clickHandler(e))),this.headerElem.addEventListener("focusin",(e=>this.focusHandler(e))),this.headerElem.addEventListener("change",(e=>this.changeHandler(e)))}}var p=function(e,t,s,i){return new(s||(s=Promise))((function(o,l){function r(e){try{c(i.next(e))}catch(e){l(e)}}function n(e){try{c(i.throw(e))}catch(e){l(e)}}function c(e){var t;e.done?o(e.value):(t=e.value,t instanceof s?t:new s((function(e){e(t)}))).then(r,n)}c((i=i.apply(e,t||[])).next())}))};class m{constructor({id:e,url:t,mod:s,callback:i}){this.options=[],this.searchOptions=[],this.selectedOption=null,this.fetchController=null,this.id=e,this.url=t,this.mod=s,this.callback=i,this.isOpen=!1,this.containerSelector=".autocomplete",this.inputWrapperSelector=`${this.containerSelector}__input`,this.optionsSelector=`${this.containerSelector}__options`,this.itemSelector=`${this.containerSelector}__options-item`;const o=document.querySelector(`#${this.id}`);o&&(this.containerElem=o);const l=this.containerElem.querySelector(this.inputWrapperSelector);l&&(this.inputWrapperElem=l);const r=this.inputWrapperElem.querySelector("input");r&&(this.inputElem=r);const n=this.containerElem.querySelector("input[hidden]");n&&(this.hiddenInputElem=n);const c=this.containerElem.querySelector(this.optionsSelector);c&&(this.optionsElem=c),this.init()}init(){this.handlers(),this.collectedInitialOptions(),this.debounce=c(this.fetchOptions,200)}renderOptions(){let e;this.optionsElem.innerHTML="",e="search"===this.mod?this.searchOptions.map((e=>`<a href="${null==e?void 0:e.href}" class="autocomplete__options-item" data-value="${null==e?void 0:e.value}" tabindex="0">\n        <img class="autocomplete__options-item-img" src="${null==e?void 0:e.imgLink}">\n        <div class="autocomplete__options-item-title">${null==e?void 0:e.label}</div>\n        <div class="autocomplete__options-item-subtitle">${null==e?void 0:e.subtitle}</div>\n      </a>`)).join(""):this.searchOptions.map((({label:e,value:t})=>`<li class="autocomplete__options-item" data-value="${t}" tabindex="0">${e}</li>`)).join(""),this.optionsElem.innerHTML=e}collectedInitialOptions(){const e=Array.from(this.containerElem.querySelectorAll(this.itemSelector));let t;t="search"===this.mod?e.reduce(((e,t)=>{var s,i;const o=null===(s=t.querySelector(`${this.itemSelector}-title`))||void 0===s?void 0:s.innerHTML,l=t.dataset.value,r=t instanceof HTMLAnchorElement?t.href:void 0,n=t.querySelector(`${this.itemSelector}-img`).src,c=null===(i=t.querySelector(`${this.itemSelector}-subtitle`))||void 0===i?void 0:i.innerHTML;return o&&l&&r&&n&&c&&e.push({label:o,value:l,href:r,imgLink:n,subtitle:c}),e}),[]):e.reduce(((e,t)=>{const s=t.innerHTML,i=t.dataset.value;return s&&i&&e.push({label:s,value:i}),e}),[]),this.options=t||[]}toggle(){this.isOpen=!this.isOpen,this.containerElem.classList.toggle("active")}selected(e){let t,s;if("search"===this.mod){const i=e.closest(this.itemSelector),o=null==i?void 0:i.querySelector(`${this.itemSelector}-title`);t=null==i?void 0:i.dataset.value,s=null==o?void 0:o.innerHTML}else t=e.dataset.value,s=e.innerHTML;s&&(this.inputElem.value=s),t&&(this.hiddenInputElem.value=t),t&&s&&(this.selectedOption={label:s,value:t}),this.callback&&s&&t&&this.callback({label:s,value:t}),Array.from(this.optionsElem.children).forEach((e=>{e.classList.remove("active"),e.dataset.value===t&&e.classList.add("active")})),this.toggle()}fetchOptions(e){return p(this,void 0,void 0,(function*(){this.fetchController=new AbortController,this.containerElem.classList.add("load");const t=yield n(`${this.url}?search=${e}`,{fetchController:this.fetchController});this.containerElem.classList.remove("load"),t.error&&"AbortError"!==t.error.name?console.error("Error fetching data:",t.error):Array.isArray(t.data)&&(this.searchOptions=t.data,this.renderOptions())}))}searchMatch(e){var t;return p(this,void 0,void 0,(function*(){if(this.url)return this.fetchController&&(null===(t=this.fetchController)||void 0===t||t.abort()),void(e&&e.length>2?this.debounce(e):(this.searchOptions=[],this.renderOptions()));const s=new RegExp(e,"i"),i=this.options.filter((e=>s.test(null==e?void 0:e.label)));this.searchOptions=i,this.renderOptions()}))}clickHandler(e){const t=e.target;(this.inputWrapperElem.contains(t)||!this.containerElem.contains(t)&&this.isOpen)&&this.toggle(),this.containerElem.contains(t)&&t.closest(this.itemSelector)&&this.selected(t)}inputHandler(e){const t=e.target;this.containerElem.contains(t)&&(this.searchMatch(t.value),this.isOpen||this.toggle())}setInput(e){var t,s;e.value=null!==(s=null===(t=this.selectedOption)||void 0===t?void 0:t.label)&&void 0!==s?s:""}blurHandler(e){var t;const s=e.target;0===s.value.length&&(null===(t=this.selectedOption)||void 0===t?void 0:t.label)&&this.setInput(s)}clearHandler(){this.selectedOption=null,this.hiddenInputElem.value="",this.callback&&this.callback({label:"",value:""})}handlers(){document.addEventListener("click",(e=>this.clickHandler(e))),document.addEventListener("input",(e=>this.inputHandler(e))),this.inputElem.addEventListener("blur",(e=>this.blurHandler(e))),this.inputElem.addEventListener("search",(()=>this.clearHandler()))}}class v{constructor(){this.selectorSelect=".select",this.selectorHeader=".select__header",this.selectorTitle=".select__title",this.selectorOptions=".select__options",this.selectorItem=".select__options-item",this.selectorIcon=".select__icon",this.allSelects=Array.from(document.querySelectorAll(".select")),0!==this.allSelects.length&&this.init()}init(){this.initialOption(),this.handlers()}initialOption(){this.allSelects.forEach((e=>{var t;const s=null===(t=e.querySelector("input"))||void 0===t?void 0:t.value,i=e.querySelector(this.selectorTitle),o=null==i?void 0:i.textContent;let l,r;r=s?e.querySelector(`[data-value="${s}"]`):e.querySelector(this.selectorItem),null==r||r.classList.add("active"),o||(l=null==r?void 0:r.innerHTML,i&&l&&(i.innerHTML=l))}))}toggle(e){const t=e.querySelector(this.selectorIcon);null==t||t.classList.toggle("active"),e.classList.toggle("active")}changeOption(e,t){var s;const i=e.querySelector(this.selectorTitle),o=e.querySelector("input"),l=t.dataset.value,r=t.innerHTML;i&&o&&l&&(i.innerHTML=r,o.value=l,document.dispatchEvent(new CustomEvent("select-change",{detail:{selectName:o.name,value:l}})),this.toggle(e)),e.querySelectorAll(this.selectorItem).forEach((e=>e.classList.remove("active"))),null===(s=null==t?void 0:t.closest(this.selectorItem))||void 0===s||s.classList.add("active")}clickHandler(e){const t=e.target,s=null==t?void 0:t.closest(this.selectorSelect);if("INPUT"!==t.tagName&&(this.allSelects.forEach((e=>{if(s!==e){e.classList.remove("active");const t=e.querySelector(this.selectorIcon);null==t||t.classList.remove("active")}})),s&&((null==t?void 0:t.closest(this.selectorHeader))&&this.toggle(s),null==t?void 0:t.closest(this.selectorOptions)))){const e=null==t?void 0:t.closest(this.selectorItem);this.changeOption(s,e)}}handlers(){document.addEventListener("click",(e=>this.clickHandler(e)))}}class S{constructor(e){this.containerSelector=e,this.autocompleteSelector=`${this.containerSelector}-input`,this.maskSelector=`${this.containerSelector}-mask`,this.crossSelector=`${this.containerSelector}-title-cross`,this.selectItemSelector=".select__options-item",this.isActive=!1;const t=document.querySelector(this.containerSelector);t&&(this.containerElem=t);const s=this.containerElem.querySelector(this.autocompleteSelector);s&&(this.autocompleteElem=s);const i=this.containerElem.querySelector(this.crossSelector);i&&(this.crossElem=i);const o=this.containerElem.querySelector(this.maskSelector);o&&(this.maskElem=o),this.containerElem?this.init():console.error(`not founded elem: ${this.containerSelector}!`)}init(){this.handlers()}activation(){this.isActive=!0,this.containerElem.classList.add("active"),document.body.classList.add("overflow")}deactivation(){this.containerElem.classList.remove("active"),this.isActive=!1,document.body.classList.remove("overflow")}selectedFilter(e){const t=e.dataset.value;console.log("value selectedFilter",t)}clickHandler(e){const t=e.target;(this.crossElem.contains(t)||this.maskElem.contains(t))&&this.deactivation(),this.autocompleteElem.contains(t)&&this.activation(),t.closest(this.selectItemSelector)&&this.selectedFilter(t)}handlers(){document.addEventListener("click",(e=>this.clickHandler(e)))}}window.addEventListener("load",(()=>{let e;!function(e){let t=new Image;t.onload=t.onerror=function(){!function(e){let t=!0===e?"webp":"no-webp";document.documentElement.classList.add(t)}(2==t.height)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}();try{new l}catch(e){console.log(e)}try{new r}catch(e){console.log(e)}try{new d({selectorForm:".login__form-sign-in",url:i.autocomplete,apiOptions:{method:"post"}})}catch(e){console.log(e)}try{new d({selectorForm:".login__form-sign-up",url:i.autocomplete,apiOptions:{method:"post"}})}catch(e){console.log(e)}try{new h}catch(e){console.log(e)}try{e=new u}catch(e){console.log(e)}try{new m({id:"search-shops"})}catch(e){console.log(e)}try{new m({id:"pickup-autocomplete",url:i.autocomplete,callback:null==e?void 0:e.selectedOption})}catch(e){console.log(e)}try{new m({id:"courier-autocomplete",url:i.autocomplete,callback:null==e?void 0:e.selectedOption})}catch(e){console.log(e)}try{new m({id:"search-pickup-autocomplete",url:i.autocomplete,callback:null==e?void 0:e.selectedOption})}catch(e){console.log(e)}try{new v}catch(e){console.log(e)}try{new S(".header__nav-search")}catch(e){console.log(e)}}))})();