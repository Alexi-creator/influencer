(()=>{"use strict";var t,e,s;!function(t){t.goods="goods",t.sp="sp",t.tff="tff",t.contacts="contacts"}(t||(t={})),function(t){t.posts="posts",t.followers="followers",t.subscriptions="subscriptions",t.likes="likes"}(e||(e={})),function(t){t.subscriptionsSp="subscriptions-sp",t.subscriptionsTff="subscriptions-tff",t.subscriptionsBloggers="subscriptions-bloggers",t.subscriptionsShops="subscriptions-shops",t.likesGoods="likes-goods",t.likesPublications="likes-publications"}(s||(s={})),Object.values(e),Object.values(s);const i={autocomplete:"https://62dd423d79b9f8c30aa554e1.mockapi.io/autocomplete"};class o{constructor(){this.selector=".popup",this.popupCloseSelector=".popup__close",this.dataAttributePopup="[data-popup]",this.dataAttributeClosePopup="[data-close-popup]",this.popupOpenClass="popup--open",this.overflowClass="overflow",this.popupOverlayClass="popup__overlay",this.init()}init(){this.handlers(),[768,1200].forEach((t=>{window.matchMedia(`(min-width:${t}px)`).addListener((t=>this.breakpointChecker(t)))}))}breakpointChecker(t){const e=t.media.replace(/\D/g,"");Array.from(document.querySelectorAll(`${this.selector}--open`)).forEach((t=>{const s=t.dataset.media;Number(e)>=Number(s)&&this.closePopup(t)}))}openPopup(t){const e=document.getElementById(t.dataset.popup||"");if(!e)throw new Error(`no attribute value: ${this.dataAttributePopup}`);{let t=!0;const s=Number(e.dataset.media);s&&s<window.innerWidth&&(t=!1),t&&(e.classList.add(this.popupOpenClass),document.body.classList.add(this.overflowClass),document.dispatchEvent(new CustomEvent("openPopup",{detail:null==e?void 0:e.id})))}}checkOpenedPopups(){return[...document.querySelectorAll(this.selector)].some((t=>t.classList.contains("popup--open")))}closePopup(t){var e;const s=t.closest(this.selector)||document.getElementById((null===(e=null==t?void 0:t.dataset)||void 0===e?void 0:e.closePopup)||"");null==s||s.classList.remove(this.popupOpenClass),this.checkOpenedPopups()||document.body.classList.remove(this.overflowClass),document.dispatchEvent(new CustomEvent("closePopup",{detail:null==s?void 0:s.id}))}clickHandler(t){const e=t.target;return e.closest(this.dataAttributeClosePopup)&&e.closest(this.dataAttributePopup)?(this.closePopup(e),this.openPopup(e.closest(this.dataAttributePopup))):e.classList.contains(this.popupOverlayClass)||e.closest(this.popupCloseSelector)||e.closest(this.dataAttributeClosePopup)?this.closePopup(e):void(e.closest(this.dataAttributePopup)&&this.openPopup(e.closest(this.dataAttributePopup)))}handlers(){document.addEventListener("click",(t=>this.clickHandler(t)))}}class n{constructor(){this.selectorActionBtn=".header__nav-more",this.selectorUsefulLinks=".useful-links",this.selectorUsefulLinksCross=".useful-links__title-cross";const t=document.querySelector(this.selectorUsefulLinks);t&&(this.usefulLinksElem=t),this.usefulLinksElem&&this.init()}init(){window.matchMedia("(min-width:1200px)").addListener((t=>this.breakpointChecker(t))),this.handlers()}breakpointChecker(t){this.usefulLinksElem.classList.contains("active")&&(t.matches?document.body.classList.remove("overflow"):document.body.classList.add("overflow"))}toggle(){this.usefulLinksElem.classList.toggle("active"),document.body.classList.toggle("overflow")}clickHandler(t){const e=t.target;(e.closest(this.selectorActionBtn)||e.closest(this.selectorUsefulLinksCross))&&this.toggle()}handlers(){document.addEventListener("click",(t=>this.clickHandler(t)))}}const r=(t,e)=>{return s=void 0,i=void 0,n=function*(){var s;const i=Object.assign(Object.assign({},{method:"get"}),e);try{const o=yield fetch(t,Object.assign(Object.assign({credentials:i.credentials,headers:"get"===i.method?{}:{"Content-Type":"application/json"}},i),{signal:null===(s=e.fetchController)||void 0===s?void 0:s.signal})),{status:n}=o,r=yield o.json();return r.detail?{error:r.detail,status:n}:{data:r,status:n}}catch(t){return{error:t}}},new((o=void 0)||(o=Promise))((function(t,e){function r(t){try{l(n.next(t))}catch(t){e(t)}}function c(t){try{l(n.throw(t))}catch(t){e(t)}}function l(e){var s;e.done?t(e.value):(s=e.value,s instanceof o?s:new o((function(t){t(s)}))).then(r,c)}l((n=n.apply(s,i||[])).next())}));var s,i,o,n},c=(t,e)=>{let s;return function(){clearTimeout(s),s=setTimeout((()=>{t.apply(this,arguments)}),e)}};class l{constructor(t,e,s){this.selectorForm=t,this.url=e,this.apiOptions=s;const i=document.querySelector(this.selectorForm);i&&(this.form=i),this.form&&this.init()}init(){this.handlers()}getData(){const t=new FormData(this.form);return Array.from(t.entries()).reduce(((t,[e,s])=>(t[e]=s,t)),{})}submitForm(){return t=this,e=void 0,i=function*(){const t=this.getData(),{method:e}=this.apiOptions;let s=this.url;if("get"===e){const e=new URLSearchParams;Object.entries(t).forEach((([t,s])=>e.append(t,String(s)))),s=`${this.url}?${e.toString()}`}else this.apiOptions=Object.assign(Object.assign({},this.apiOptions),{body:JSON.stringify(t)});return yield r(s,this.apiOptions)},new((s=void 0)||(s=Promise))((function(o,n){function r(t){try{l(i.next(t))}catch(t){n(t)}}function c(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,c)}l((i=i.apply(t,e||[])).next())}));var t,e,s,i}validateForm(){}resetForm(){}handlers(){this.form.addEventListener("submit",(t=>{t.preventDefault(),this.submitForm()}))}}class a{constructor(){this.selectorContainer=".login",this.selectorBtnSignIn=".login__choice-sign-in",this.selectorBtnSignUp=".login__choice-sign-up";const t=document.querySelector(this.selectorContainer);t&&(this.containerElem=t);const e=document.querySelector(this.selectorBtnSignIn);e&&(this.btnSignInElem=e);const s=document.querySelector(this.selectorBtnSignUp);s&&(this.btnSignUpElem=s),this.btnSignInElem&&this.btnSignUpElem?this.init():console.error(`No items found: ${this.selectorBtnSignIn}, ${this.selectorBtnSignUp}`)}init(){this.handlers()}toggle(t){t.closest(this.selectorBtnSignIn)?(this.containerElem.classList.remove(`${this.selectorContainer.substring(1)}--sign-up`),this.containerElem.classList.add(`${this.selectorContainer.substring(1)}--sign-in`)):(this.containerElem.classList.remove(`${this.selectorContainer.substring(1)}--sign-in`),this.containerElem.classList.add(`${this.selectorContainer.substring(1)}--sign-up`))}clickHandler(t){const e=t.target;(e.closest(this.selectorBtnSignIn)||e.closest(this.selectorBtnSignUp))&&this.toggle(e)}handlers(){document.addEventListener("click",(t=>this.clickHandler(t)))}}class h{constructor(){this.selectedOption=t=>{console.log("selected option autocomplete",t),"pickup"===this.deliveryType&&(t.value?(this.searchPickupBtnElem.disabled=!1,this.mapPickupBtnElem.disabled=!1,this.pickupSelected=t,window.innerWidth<1200?this.pickupInputElem.value=t.label:this.searchInputElem.value=t.label):(this.searchPickupBtnElem.disabled=!0,this.mapPickupBtnElem.disabled=!0,this.pickupSelected={label:"",value:""},window.innerWidth<1200?this.pickupInputElem.value="":this.searchInputElem.value="")),"courier"===this.deliveryType&&(t.value?(this.mapCourierBtnElem.disabled=!1,this.courierSelected=t,this.courierFullAddressElem.innerHTML="",this.courierFullAddressElem.innerHTML=t.label):(this.mapCourierBtnElem.disabled=!0,this.courierSelected={label:"",value:""},this.courierFullAddressElem.innerHTML=""))},this.mapId="#maps",this.searchPickupId="#search-pickup",this.courierAddressId="#courier",this.templateAddressId="#address",this.isLoadMap=!1,this.deliveryType="pickup",this.headerSelector=".header",this.mapSelector=".map",this.courierSelector=".courier",this.searchPickupSelector=".search-pickup",this.pickupInputSelector=".map__autocomplete--pickup input",this.courierInputSelector=".map__autocomplete--courier input",this.searchInputSelector=`${this.searchPickupSelector} input`,this.mapYandexSelector=".map__yandex",this.addressSelector=".location__address",this.addressSelectedSelector=`${this.addressSelector}--selected`,this.addressRemoveSelector=`${this.addressSelector}-remove`,this.locationAddressesSelector=".location__addresses",this.radioDeliveryName="choose-delivery",this.courierFullAddress=`${this.courierSelector}__actions-inputs-full`,this.searchPickupBtnSelector=`${this.searchPickupSelector}__btn`,this.mapPickupBtnSelector=`${this.mapSelector}__btn--pickup`,this.mapCourierBtnSelector=`${this.mapSelector}__btn--courier`,this.addressElems=Array.from(document.querySelectorAll(this.addressSelector));const t=document.querySelector(this.mapId);t&&(this.iframeMapElem=t);const e=document.querySelector(this.templateAddressId);e&&(this.templateAddressElem=e);const s=document.querySelector(this.searchPickupId);s&&(this.searchPickupElem=s);const i=this.searchPickupElem.querySelector(this.searchInputSelector);i&&(this.searchInputElem=i);const o=this.searchPickupElem.querySelector(this.searchPickupBtnSelector);o&&(this.searchPickupBtnElem=o);const n=document.querySelector(this.courierAddressId);n&&(this.courierAddressElem=n);const r=document.querySelector(this.mapSelector);r&&(this.mapElem=r);const c=document.querySelector(this.mapYandexSelector);c&&(this.mapYandexElem=c);const l=this.mapElem.querySelector(this.mapPickupBtnSelector);l&&(this.mapPickupBtnElem=l);const a=this.mapElem.querySelector(this.mapCourierBtnSelector);a&&(this.mapCourierBtnElem=a);const h=document.querySelector(this.pickupInputSelector);h&&(this.pickupInputElem=h);const d=document.querySelector(this.courierInputSelector);d&&(this.courierInputElem=d);const u=document.querySelector(this.headerSelector);u&&(this.headerElem=u);const p=document.querySelector(this.locationAddressesSelector);p&&(this.locationAddressesElem=p);const m=document.querySelector(this.courierFullAddress);m&&(this.courierFullAddressElem=m),this.init()}init(){this.handlers(),this.mapElem.classList.add(`${this.mapSelector.substring(1)}--pickup`),window.matchMedia("(min-width:1200px)").addListener((t=>this.breakpointChecker(t))),navigator.geolocation.getCurrentPosition((function(t){console.log("geolocation",t.coords.latitude,t.coords.longitude)}),(function(t){console.log(t.message)}))}breakpointChecker(t){t.matches&&(this.searchPickupElem.classList.remove("popup--open"),this.courierAddressElem.classList.remove("popup--open"))}selectedAddress(t){this.addressElems.forEach((e=>{e.classList.remove(this.addressSelectedSelector.substring(1)),e===t&&e.classList.add(this.addressSelectedSelector.substring(1))}))}addAddress(t){let e=!0;if(this.pickupSelected&&(e=this.addressElems.some((t=>{var e;return t.dataset.value===(null===(e=this.pickupSelected)||void 0===e?void 0:e.value)}))),this.courierSelected&&(e=this.addressElems.some((t=>{var e;return t.dataset.value===(null===(e=this.courierSelected)||void 0===e?void 0:e.value)}))),!e){const e=this.templateAddressElem.content.cloneNode(!0),s=e.querySelector(".location__address"),i=e.querySelector(".location__address-option"),o=e.querySelector(".location__address-address");s&&i&&o&&("pickup"===t&&this.pickupSelected&&(o.textContent=this.pickupSelected.label,i.textContent="Пункт выдачи",s.dataset.value=this.pickupSelected.value),"courier"===t&&this.courierSelected&&(o.textContent=this.courierSelected.label,i.textContent="Доставка по адресу",s.dataset.value=this.courierSelected.value)),this.locationAddressesElem.prepend(e),this.addressElems=Array.from(document.querySelectorAll(this.addressSelector))}}removeAddress(t){return e=this,s=void 0,o=function*(){const e=t.dataset.value;console.log("remove address",e),t.remove(),this.addressElems=Array.from(document.querySelectorAll(this.addressSelector))},new((i=void 0)||(i=Promise))((function(t,n){function r(t){try{l(o.next(t))}catch(t){n(t)}}function c(t){try{l(o.throw(t))}catch(t){n(t)}}function l(e){var s;e.done?t(e.value):(s=e.value,s instanceof i?s:new i((function(t){t(s)}))).then(r,c)}l((o=o.apply(e,s||[])).next())}));var e,s,i,o}openPopup(t){t.classList.add("popup--open")}changeDelivery(t){"courier"===t?(this.mapElem.classList.remove(`${this.mapSelector.substring(1)}--pickup`),this.mapElem.classList.add(`${this.mapSelector.substring(1)}--courier`)):(this.mapElem.classList.remove(`${this.mapSelector.substring(1)}--courier`),this.mapElem.classList.add(`${this.mapSelector.substring(1)}--pickup`)),this.deliveryType=t}loadMap(){const t=this.iframeMapElem.dataset.src;this.iframeMapElem.addEventListener("load",(()=>{this.mapYandexElem.classList.add(`${this.mapYandexSelector.substring(1)}--load`)})),t&&(this.iframeMapElem.src=t,this.isLoadMap=!0)}clickHandler(t){const e=t.target,s=e.closest(this.addressSelector),i=e.closest(this.addressRemoveSelector);!this.isLoadMap&&e.closest('[data-popup="map"]')&&this.loadMap(),i&&s&&this.removeAddress(s),s&&!i&&this.selectedAddress(s),this.mapPickupBtnElem.contains(e)&&this.addAddress("pickup"),this.mapCourierBtnElem.contains(e)&&window.innerWidth<1200&&this.openPopup(this.courierAddressElem)}focusHandler(t){t.target===this.pickupInputElem&&window.innerWidth<1200&&"pickup"===this.deliveryType&&(this.openPopup(this.searchPickupElem),this.pickupInputElem.blur())}changeHandler(t){const e=t.target,s=e.name,i=e.value;s===this.radioDeliveryName&&this.changeDelivery(i)}handlers(){this.headerElem.addEventListener("click",(t=>this.clickHandler(t))),this.headerElem.addEventListener("focusin",(t=>this.focusHandler(t))),this.headerElem.addEventListener("change",(t=>this.changeHandler(t)))}}var d=function(t,e,s,i){return new(s||(s=Promise))((function(o,n){function r(t){try{l(i.next(t))}catch(t){n(t)}}function c(t){try{l(i.throw(t))}catch(t){n(t)}}function l(t){var e;t.done?o(t.value):(e=t.value,e instanceof s?e:new s((function(t){t(e)}))).then(r,c)}l((i=i.apply(t,e||[])).next())}))};class u{constructor({id:t,url:e,mod:s,callback:i}){this.options=[],this.searchOptions=[],this.selectedOption=null,this.fetchController=null,this.id=t,this.url=e,this.mod=s,this.callback=i,this.isOpen=!1,this.containerSelector=".autocomplete",this.inputWrapperSelector=`${this.containerSelector}__input`,this.optionsSelector=`${this.containerSelector}__options`,this.itemSelector=`${this.containerSelector}__options-item`;const o=document.querySelector(`#${this.id}`);o&&(this.containerElem=o);const n=this.containerElem.querySelector(this.inputWrapperSelector);n&&(this.inputWrapperElem=n);const r=this.inputWrapperElem.querySelector("input");r&&(this.inputElem=r);const c=this.containerElem.querySelector("input[hidden]");c&&(this.hiddenInputElem=c);const l=this.containerElem.querySelector(this.optionsSelector);l&&(this.optionsElem=l),this.init()}init(){this.handlers(),this.collectedInitialOptions(),this.debounce=c(this.fetchOptions,200)}renderOptions(){let t;this.optionsElem.innerHTML="",t="search"===this.mod?this.searchOptions.map((t=>`<a href="${null==t?void 0:t.href}" class="autocomplete__options-item" data-value="${null==t?void 0:t.value}" tabindex="0">\n        <img class="autocomplete__options-item-img" src="${null==t?void 0:t.imgLink}">\n        <div class="autocomplete__options-item-title">${null==t?void 0:t.label}</div>\n        <div class="autocomplete__options-item-subtitle">${null==t?void 0:t.subtitle}</div>\n      </a>`)).join(""):this.searchOptions.map((({label:t,value:e})=>`<li class="autocomplete__options-item" data-value="${e}" tabindex="0">${t}</li>`)).join(""),this.optionsElem.innerHTML=t}collectedInitialOptions(){const t=Array.from(this.containerElem.querySelectorAll(this.itemSelector));let e;e="search"===this.mod?t.reduce(((t,e)=>{var s,i;const o=null===(s=e.querySelector(`${this.itemSelector}-title`))||void 0===s?void 0:s.innerHTML,n=e.dataset.value,r=e instanceof HTMLAnchorElement?e.href:void 0,c=e.querySelector(`${this.itemSelector}-img`).src,l=null===(i=e.querySelector(`${this.itemSelector}-subtitle`))||void 0===i?void 0:i.innerHTML;return o&&n&&r&&c&&l&&t.push({label:o,value:n,href:r,imgLink:c,subtitle:l}),t}),[]):t.reduce(((t,e)=>{const s=e.innerHTML,i=e.dataset.value;return s&&i&&t.push({label:s,value:i}),t}),[]),this.options=e||[]}toggle(){this.isOpen=!this.isOpen,this.containerElem.classList.toggle("active")}selected(t){let e,s;if("search"===this.mod){const i=t.closest(this.itemSelector),o=null==i?void 0:i.querySelector(`${this.itemSelector}-title`);e=null==i?void 0:i.dataset.value,s=null==o?void 0:o.innerHTML}else e=t.dataset.value,s=t.innerHTML;s&&(this.inputElem.value=s),e&&(this.hiddenInputElem.value=e),e&&s&&(this.selectedOption={label:s,value:e}),this.callback&&s&&e&&this.callback({label:s,value:e}),Array.from(this.optionsElem.children).forEach((t=>{t.classList.remove("active"),t.dataset.value===e&&t.classList.add("active")})),this.toggle()}fetchOptions(t){return d(this,void 0,void 0,(function*(){this.fetchController=new AbortController,this.containerElem.classList.add("load");const e=yield r(`${this.url}?search=${t}`,{fetchController:this.fetchController});this.containerElem.classList.remove("load"),e.error&&"AbortError"!==e.error.name?console.error("Error fetching data:",e.error):Array.isArray(e.data)&&(this.searchOptions=e.data,this.renderOptions())}))}searchMatch(t){var e;return d(this,void 0,void 0,(function*(){if(this.url)return this.fetchController&&(null===(e=this.fetchController)||void 0===e||e.abort()),void(t&&t.length>2?this.debounce(t):(this.searchOptions=[],this.renderOptions()));const s=new RegExp(t,"i"),i=this.options.filter((t=>s.test(null==t?void 0:t.label)));this.searchOptions=i,this.renderOptions()}))}clickHandler(t){const e=t.target;(this.inputWrapperElem.contains(e)||!this.containerElem.contains(e)&&this.isOpen)&&this.toggle(),this.containerElem.contains(e)&&e.closest(this.itemSelector)&&this.selected(e)}inputHandler(t){const e=t.target;this.containerElem.contains(e)&&(this.searchMatch(e.value),this.isOpen||this.toggle())}setInput(t){var e,s;t.value=null!==(s=null===(e=this.selectedOption)||void 0===e?void 0:e.label)&&void 0!==s?s:""}blurHandler(t){var e;const s=t.target;0===s.value.length&&(null===(e=this.selectedOption)||void 0===e?void 0:e.label)&&this.setInput(s)}clearHandler(){this.selectedOption=null,this.hiddenInputElem.value="",this.callback&&this.callback({label:"",value:""})}handlers(){document.addEventListener("click",(t=>this.clickHandler(t))),document.addEventListener("input",(t=>this.inputHandler(t))),this.inputElem.addEventListener("blur",(t=>this.blurHandler(t))),this.inputElem.addEventListener("search",(()=>this.clearHandler()))}}class p{constructor(){this.selectorSelect=".select",this.selectorHeader=".select__header",this.selectorTitle=".select__title",this.selectorOptions=".select__options",this.selectorItem=".select__options-item",this.selectorIcon=".select__icon",this.allSelects=Array.from(document.querySelectorAll(".select")),0!==this.allSelects.length&&this.init()}init(){this.initialOption(),this.handlers()}initialOption(){this.allSelects.forEach((t=>{var e;const s=null===(e=t.querySelector("input"))||void 0===e?void 0:e.value,i=t.querySelector(this.selectorTitle);if(null==i?void 0:i.textContent)return;let o,n;if(s){const e=t.querySelector(`[data-value=${s}]`);o=null==e?void 0:e.innerHTML,n=e}else{const e=t.querySelector(this.selectorItem);o=null==e?void 0:e.innerHTML,n=e}i&&o&&(i.innerHTML=o),null==n||n.classList.add("active")}))}toggle(t){const e=t.querySelector(this.selectorIcon);null==e||e.classList.toggle("active"),t.classList.toggle("active")}changeOption(t,e){var s;const i=t.querySelector(this.selectorTitle),o=t.querySelector("input"),n=e.dataset.value,r=e.innerHTML;i&&o&&n&&(i.innerHTML=r,o.value=n,document.dispatchEvent(new CustomEvent("select-change",{detail:n})),this.toggle(t)),t.querySelectorAll(this.selectorItem).forEach((t=>t.classList.remove("active"))),null===(s=null==e?void 0:e.closest(this.selectorItem))||void 0===s||s.classList.add("active")}clickHandler(t){const e=t.target,s=null==e?void 0:e.closest(this.selectorSelect);"INPUT"!==e.tagName&&(this.allSelects.forEach((t=>{if(s!==t){t.classList.remove("active");const e=t.querySelector(this.selectorIcon);null==e||e.classList.remove("active")}})),s&&((null==e?void 0:e.closest(this.selectorHeader))&&this.toggle(s),(null==e?void 0:e.closest(this.selectorOptions))&&this.changeOption(s,e)))}handlers(){document.addEventListener("click",(t=>this.clickHandler(t)))}}window.addEventListener("load",(()=>{let t;!function(t){let e=new Image;e.onload=e.onerror=function(){!function(t){let e=!0===t?"webp":"no-webp";document.documentElement.classList.add(e)}(2==e.height)},e.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"}();try{new o}catch(t){console.log(t)}try{new n}catch(t){console.log(t)}try{new l(".login__form-sign-in",i.autocomplete,{method:"post"})}catch(t){console.log(t)}try{new l(".login__form-sign-up",i.autocomplete,{method:"post"})}catch(t){console.log(t)}try{new a}catch(t){console.log(t)}try{t=new h}catch(t){console.log(t)}try{new u({id:"search-shops"})}catch(t){console.log(t)}try{new u({id:"pickup-autocomplete",url:i.autocomplete,callback:null==t?void 0:t.selectedOption})}catch(t){console.log(t)}try{new u({id:"courier-autocomplete",url:i.autocomplete,callback:null==t?void 0:t.selectedOption})}catch(t){console.log(t)}try{new u({id:"search-pickup-autocomplete",url:i.autocomplete,callback:null==t?void 0:t.selectedOption})}catch(t){console.log(t)}try{new p}catch(t){console.log(t)}}));class m{constructor(){this.selector=".collapse",this.init()}init(){this.handlers()}toggleCollapse(t){const e=t.closest(this.selector);e&&(e.classList.contains("collapse--close")?(e.classList.remove("collapse--close"),e.classList.add("collapse--open")):(null==e?void 0:e.classList.contains("collapse--open"))?(e.classList.remove("collapse--open"),e.classList.add("collapse--close")):e.classList.add("collapse--close"))}clickHandler(t){const e=t.target;if(e.closest(".collapse__head")&&"INPUT"!==e.tagName)return this.toggleCollapse(e)}handlers(){document.addEventListener("click",(t=>this.clickHandler(t)))}}class v{constructor({selectorMain:t,selectorContainer:e,selectorActionBtn:s}){this.selectorContainer=e,this.selectorActionBtn=s,this.selectorFilterWrapper=`${t}__form-filter`,this.selectorFiltersWrapper=`${t}__form-filter-filters`,this.selectorChips=`${t}__form-chips`,this.selectorFilterCross=`${t}__form-filter-cross`,this.selectorChipCross=".chip__cross",this.selectorClearBtn=`${t}__form-filter-clear`,this.selectorSubmitBtn=`${t}__form-filter-submit`,this.selectorBtnCount=`${t}__actions-filters-count`,this.selectorIconCross=`${t}__actions-icon--cross`,this.isOpen=!1;const i=document.querySelector(this.selectorContainer);i&&(this.container=i);const o=document.querySelector(this.selectorActionBtn);o&&(this.filterActionBtn=o);const n=this.container.querySelector(this.selectorFilterWrapper);n&&(this.filterWrapper=n);const r=this.container.querySelector(this.selectorFiltersWrapper);r&&(this.filtersWrapper=r);const c=this.container.querySelector(this.selectorChips);c&&(this.chipsWrapper=c);const l=this.filterActionBtn.querySelector(this.selectorBtnCount);l&&(this.btnCount=l);const a=this.filterWrapper.querySelector(this.selectorSubmitBtn);a&&(this.submitBtn=a);const h=this.filterWrapper.querySelector(this.selectorClearBtn);h&&(this.clearBtn=h);const d=this.container.querySelector(this.selectorFilterCross);d&&(this.filterCross=d),this.category=this.selectorContainer.split("-").pop(),this.filterActionBtn&&this.container&&this.init()}init(){this.handlers(),this.collectionOptions(),window.matchMedia("(min-width:1200px)").addListener((t=>this.breakpointChecker(t)))}breakpointChecker(t){if(!this.container.classList.contains("hide")){if(t.matches&&this.isOpen)return document.body.classList.remove("overflow");!t.matches&&this.isOpen&&document.body.classList.add("overflow")}}chipTemplate(t,e,s){return`\n      <div class="chip">\n        <span class="chip__title">${t}:</span>\n        <span class="chip__options">${e}</span>\n        ${s>0?`<span class="chip__more">и еще ${s}</span>`:""}\n        <svg class="chip__cross">\n          <use xlink:href="./img/icons/icons.svg#cross"></use>\n        </svg>\n      </div>\n    `}collectionOptions(){this.filters=Array.from(this.filtersWrapper.querySelectorAll(".filters__item")).reduce(((t,e)=>{var s,i;const o=null===(i=null===(s=e.querySelector(".collapse__head-title"))||void 0===s?void 0:s.textContent)||void 0===i?void 0:i.trim(),n=Array.from(e.querySelectorAll('input[type="checkbox"]:checked')).map((t=>{var e,s,i;return null===(i=null===(s=null===(e=t.closest(".checkbox"))||void 0===e?void 0:e.querySelector(".checkbox__label"))||void 0===s?void 0:s.textContent)||void 0===i?void 0:i.trim()})).sort()||[];return o&&(t[o]={selectedOptions:n,moreCount:n.length-3}),t}),{}),this.displayChips(),this.changeCount()}changeCount(){const t=Object.entries(this.filters).reduce(((t,e)=>t+e[1].selectedOptions.length),0);this.selectedCount=t;const e=this.submitBtn.querySelector(".btn__suffix");t?(this.filterActionBtn.classList.add("btn--tag","btn--tag-checked","hide-icon"),this.filterActionBtn.classList.remove("btn--color-grey","hide-count"),this.btnCount.innerHTML=String(t),this.btnCount.classList.add(`${this.selectorBtnCount.substring(1)}--active`),e.innerHTML=`(${t})`):(this.filterActionBtn.classList.remove("btn--tag","btn--tag-checked","hide-icon"),this.filterActionBtn.classList.add("btn--color-grey","hide-count"),this.btnCount.innerHTML="",this.btnCount.classList.remove(`${this.selectorBtnCount.substring(1)}--active`),e.innerHTML="")}changeOptions(t){var e,s,i,o,n,r,c,l,a,h;const{checked:d}=t,u=null===(i=null===(s=null===(e=t.closest(".collapse"))||void 0===e?void 0:e.querySelector(".collapse__head-title"))||void 0===s?void 0:s.textContent)||void 0===i?void 0:i.trim(),p=null===(r=null===(n=null===(o=t.closest(".checkbox"))||void 0===o?void 0:o.querySelector(".checkbox__label"))||void 0===n?void 0:n.textContent)||void 0===r?void 0:r.trim(),m=t.classList.contains("range__input");if(u&&p){const t=this.filters[u].selectedOptions;this.filters[u].selectedOptions=d?[...t,p].sort():t.filter((t=>t!==p)),this.filters[u].moreCount=this.filters[u].selectedOptions.length-3}if(m&&u){const e=t.value;if("min"in t.dataset){const s=null===(l=null===(c=t.closest(".range__inputs"))||void 0===c?void 0:c.querySelector(".range__input-max"))||void 0===l?void 0:l.value;this.filters[u].selectedOptions=[`от ${e} до ${s}`]}if("max"in t.dataset){const s=null===(h=null===(a=t.closest(".range__inputs"))||void 0===a?void 0:a.querySelector(".range__input-min"))||void 0===h?void 0:h.value;this.filters[u].selectedOptions=[`от ${s} до ${e}`]}}this.chipsWrapper.innerHTML="",this.displayChips(),this.toggleChips(),this.changeCount()}displayChips(){const t=Object.entries(this.filters).filter((t=>t[1].selectedOptions.length));t.length&&t.forEach((([t,{moreCount:e,selectedOptions:s}])=>{const i=s.slice(0,3).join(", "),o=this.chipTemplate(t,i,e);this.chipsWrapper&&(this.chipsWrapper.innerHTML+=o,this.chipsWrapper.classList.add("active"))}))}removeChips(t){var e,s;const i=t.closest(".chip"),o=null===(s=null===(e=null==i?void 0:i.querySelector(".chip__title"))||void 0===e?void 0:e.textContent)||void 0===s?void 0:s.trim().replace(":","");if(o){const t=Array.from(this.filterWrapper.querySelectorAll(".collapse__head-title")).filter((t=>{var e;return(null===(e=null==t?void 0:t.textContent)||void 0===e?void 0:e.trim())===o})),e=t[0].closest(".filters__item"),s=null==e?void 0:e.querySelectorAll('input[type="checkbox"]:checked');null==s||s.forEach((t=>t.checked=!1)),this.filters[o].selectedOptions=[]}null==i||i.remove(),this.changeCount(),this.toggleChips()}toggleChips(){this.chipsWrapper&&0===Array.from(this.chipsWrapper.children||[]).length&&this.chipsWrapper.classList.remove("active")}toggleFilter(){this.isOpen?(this.filterWrapper.classList.remove("active"),this.filterActionBtn.classList.remove("active"),this.selectedCount&&(this.filterActionBtn.classList.add("hide-icon"),this.filterActionBtn.classList.remove("hide-count")),this.isOpen=!1,document.body.classList.remove("overflow")):(this.filterWrapper.classList.add("active"),this.filterActionBtn.classList.add("active"),this.selectedCount&&(this.filterActionBtn.classList.remove("hide-icon"),this.filterActionBtn.classList.add("hide-count")),this.isOpen=!0,window.innerWidth<1200&&document.body.classList.add("overflow"))}clearAllFilters(){Object.entries(this.filters).forEach((t=>{t[1].selectedOptions=[],t[1].moreCount=-3}));const t=this.filtersWrapper.querySelectorAll('input[type="checkbox"]:checked');null==t||t.forEach((t=>t.checked=!1)),this.chipsWrapper&&(this.chipsWrapper.innerHTML="",this.chipsWrapper.classList.remove("active")),this.changeCount()}clickHandler(t){const e=t.target;return this.filterActionBtn.contains(e)||this.filterCross.contains(e)?this.toggleFilter():e.closest(this.selectorChipCross)&&this.container.contains(e)?this.removeChips(e):e.classList.contains("clear-filters")&&this.isOpen?this.clearAllFilters():void 0}changeHandler(t){const e=t.target;this.changeOptions(e)}checkPopup(t){if(this.isOpen){const e=t.detail.split("-").pop();e===this.category&&document.body.classList.add("overflow"),"clearFilter"===e&&window.innerWidth<1200&&document.body.classList.add("overflow")}}handlers(){document.addEventListener("click",(t=>this.clickHandler(t))),document.addEventListener("closePopup",(t=>this.checkPopup(t))),this.filterWrapper.addEventListener("change",(t=>this.changeHandler(t)))}}class g{constructor(){this.selector=".scroll",0!==document.querySelectorAll(this.selector).length&&this.init()}init(){this.handlers()}scroll(t){t?t.scrollIntoView({behavior:"smooth"}):document.body.scrollIntoView({behavior:"smooth"})}searchTarget(t){const e=t.dataset.target;if(e){const t=document.querySelector(`.${e}`);if(t)return this.scroll(t)}this.scroll()}clickHandler(t){const e=t.target.closest(this.selector);e&&this.searchTarget(e)}handlers(){document.addEventListener("click",(t=>this.clickHandler(t)))}}class f{constructor({selectorContainer:t,selectorActionContainer:e}){this.selectorContainer=t,this.selectorActionContainer=e,this.selectorActionBtn=`${this.selectorActionContainer} .filter-actions__sorts`,this.selectorSortingWrapper=".sorting",this.selectorCross=".sorting__cross",this.selectorIconCross=".filter-actions__icon--cross";const s=document.querySelector(this.selectorContainer);s&&(this.container=s);const i=document.querySelector(this.selectorActionContainer);i&&(this.actionContainer=i);const o=document.querySelector(this.selectorActionBtn);o&&(this.sortingActionBtn=o);const n=this.container.querySelector(this.selectorSortingWrapper);n&&(this.sortingWrapper=n);const r=this.container.querySelector(this.selectorCross);r&&(this.sortingCross=r),this.isOpen=!1,this.isSelected=!1,this.defaultContentBtn=this.sortingActionBtn.innerHTML,this.selectedContentBtn="",this.sortingActionBtn&&this.container&&this.init()}init(){this.handlers();const t=window.matchMedia("(min-width:1200px)"),e=window.matchMedia("(min-width:768px)");t.addListener((t=>this.breakpointChecker(t,1200))),e.addListener((t=>this.breakpointChecker(t,768)))}toggleOverflowBody(t){if(!this.container.classList.contains("hide")){if(t.matches&&this.isOpen)return document.body.classList.remove("overflow");!t.matches&&this.isOpen&&document.body.classList.add("overflow")}}toggleContentBtn(t){if(t.matches&&this.selectedContentBtn)return this.sortingActionBtn.innerHTML=this.selectedContentBtn;this.sortingActionBtn.innerHTML=this.defaultContentBtn}breakpointChecker(t,e){this.actionContainer.classList.contains("active")&&(1200===e&&this.toggleOverflowBody(t),768===e&&this.toggleContentBtn(t))}toggleSorting(){this.isOpen?(this.sortingWrapper.classList.remove("active"),this.sortingActionBtn.classList.remove("active"),this.isOpen=!1,document.body.classList.remove("overflow"),this.selectedContentBtn&&window.innerWidth>768&&(this.sortingActionBtn.innerHTML=this.selectedContentBtn)):(this.sortingWrapper.classList.add("active"),this.sortingActionBtn.classList.add("active"),this.isOpen=!0,window.innerWidth<1200&&document.body.classList.add("overflow"),this.sortingActionBtn.innerHTML=this.defaultContentBtn)}chooseSorting(t){var e;this.isSelected=!0,this.selectedElem=t;const s=t.closest(".radio"),i=null===(e=null==s?void 0:s.querySelector(".btn"))||void 0===e?void 0:e.innerHTML;i&&(this.selectedContentBtn=i,window.innerWidth>768&&(this.sortingActionBtn.innerHTML=i)),this.sortingActionBtn.classList.remove("btn--color-grey"),this.sortingActionBtn.classList.add("btn--tag","btn--tag-checked"),this.toggleSorting()}clearSort(){this.isSelected&&(this.selectedContentBtn="",this.sortingActionBtn.classList.remove("btn--tag","btn--tag-checked"),this.sortingActionBtn.classList.add("btn--color-grey"),this.sortingActionBtn.innerHTML=this.defaultContentBtn,this.selectedElem&&(this.selectedElem.checked=!1),this.isSelected=!1,this.selectedElem=null),this.toggleSorting()}changeHandler(t){const e=t.target;e.checked&&this.sortingWrapper.contains(e)&&this.chooseSorting(e)}clickHandler(t){const e=t.target;return e.closest(this.selectorIconCross)&&this.sortingActionBtn.contains(e)?this.clearSort():this.sortingActionBtn.contains(e)||this.sortingCross.contains(e)?this.toggleSorting():void 0}handlers(){document.addEventListener("click",(t=>this.clickHandler(t))),this.sortingWrapper.addEventListener("change",(t=>this.changeHandler(t)))}}class S{constructor(){this.selectorContainer=".ticker",this.selectorText=`${this.selectorContainer}__text`,this.init()}init(){this.handlers()}setActivation(t,e){e?t.classList.add("active"):t.classList.remove("active")}checkTextLength(t){var e;const s=t.clientWidth;((null===(e=t.querySelector(this.selectorText))||void 0===e?void 0:e.clientWidth)||0)>s&&this.setActivation(t,!0)}mouseoverHandler(t){const e=t.target.closest(this.selectorContainer);e&&this.checkTextLength(e)}mouseoutHandler(t){const e=t.target.closest(this.selectorContainer);e&&this.setActivation(e,!1)}handlers(){document.addEventListener("mouseover",(t=>this.mouseoverHandler(t))),document.addEventListener("mouseout",(t=>this.mouseoutHandler(t)))}}window.addEventListener("load",(()=>{try{new u({id:"users-autocomplete"})}catch(t){console.log(t)}try{new m}catch(t){console.log(t)}try{new f({selectorContainer:".user-card-list__form",selectorActionContainer:".filter-actions"})}catch(t){console.log(t)}try{new v({selectorMain:".user-card-list",selectorContainer:".user-card-list__form",selectorActionBtn:".filter-actions__filters"})}catch(t){console.log(t)}try{new l(".user-card-list__form",i.autocomplete,{method:"post"})}catch(t){console.log(t)}try{new g}catch(t){console.log(t)}try{new S}catch(t){console.log(t)}}))})();